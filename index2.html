async function createChoropleth() {
    try {
        const response = await fetch('housing_prices.csv'); // Fetch the CSV
        const priceData = await response.text();

        const rows = priceData.split('\n').slice(1);
        const districts = [];
        const prices = [];

        rows.forEach(row => {
            const cols = row.split(',');
            if (cols.length > 1) { // Ensure there's data
                districts.push(cols[0]); // Assuming first column is district_id
                prices.push(parseFloat(cols[1])); // Assuming second column is median price
            }
        });

        // Log districts and prices for debugging
        console.log('Districts:', districts);
        console.log('Prices:', prices);

        const geojsonResponse = await fetch('ub.geojson'); // Fetch the GeoJSON
        const geojson = await geojsonResponse.json();

        // Log geojson data for debugging
        console.log('GeoJSON:', geojson);

        const choroplethLayout = {
            title: "Улаанбаатар хотын орон сууцны үнэ",
            geo: {
                scope: 'asia',
                showland: true,
                landcolor: 'rgb(243, 243, 243)',
                subunitcolor: 'rgb(255, 255, 255)',
                countrycolor: 'rgb(255, 255, 255)',
                showlakes: true,
                lakecolor: 'rgb(255, 255, 255)',
            }
        };

        const choroplethData = [{
            type: 'choropleth',
            z: prices,
            locations: districts,
            locationmode: 'geojson-id',
            geojson: geojson,
            colorbar: {
                title: 'Сая төгрөг'
            }
        }];

        Plotly.newPlot('choropleth-chart', choroplethData, choroplethLayout);
    } catch (error) {
        console.error('Error fetching or processing data:', error);
    }
}
